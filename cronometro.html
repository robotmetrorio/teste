<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>RôBot - Atendimento Digital</title>

    <style>
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            font-family: Arial, sans-serif;
            background: url('imagens/fundo.jpg') center center no-repeat;
            background-size: cover;
            background-attachment: fixed;
            overflow: hidden;
        }

        .video-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 0;
            pointer-events: none;
        }

        .video-overlay video {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .container {
            position: absolute;
            top: 10%;
            margin-left: 358px;
            width: 980px;
            height: 86%;
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 1;
        }

        .content-frame {
            width: 77%;
            height: 100%;
            border: 3px solid cyan;
            border-radius: 15px;
            z-index: 2;
        }

        #usuario {
            position: absolute;
            top: 43px;
            left: 485px;
            z-index: 2;
            color: white;
            font-size: 15px;
            font-weight: bold;
            text-shadow: 1px 1px 4px black;
        }

        #cronometro {
            position: absolute;
            bottom: 25px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.6);
            padding: 10px 20px;
            border-radius: 10px;
            color: white;
            font-size: 18px;
            font-weight: bold;
            z-index: 3;
            text-align: center;
        }
    </style>
</head>
<body>

    <div class="video-overlay">
        <video autoplay muted loop playsinline>
            <source src="midias/terceirovideo.mp4" type="video/mp4">
            Seu navegador não suporta vídeo.
        </video>
    </div>

    <div class="container">
        <iframe name="content" class="content-frame" src="menu.principal.html"></iframe>
    </div>

    <div id="usuario">
        Colaborador(a): <span id="nomeUsuario">...</span>
    </div>

    <div id="cronometro">Inatividade: 00:00</div>

    <script>
        let timeout;
        const TEMPO_INATIVIDADE = 1 * 60 * 1000;
        let tempoRestante = TEMPO_INATIVIDADE;
        let intervalo;
        let ultimoDocMonitorado = null;

        function redirecionar() {
            window.location.href = "index.html";
        }

        function atualizarCronometro() {
            const segundos = Math.floor(tempoRestante / 1000);
            const min = String(Math.floor(segundos / 60)).padStart(2, '0');
            const seg = String(segundos % 60).padStart(2, '0');
            document.getElementById("cronometro").textContent = "Inatividade: " + min + ":" + seg;
        }

        function iniciarContagem() {
            clearInterval(intervalo);
            tempoRestante = TEMPO_INATIVIDADE;
            atualizarCronometro();
            intervalo = setInterval(() => {
                tempoRestante -= 1000;
                atualizarCronometro();
                if (tempoRestante <= 0) {
                    clearInterval(intervalo);
                    redirecionar();
                }
            }, 1000);
        }

        function resetarTemporizador() {
            clearTimeout(timeout);
            iniciarContagem();
        }

        // Escuta mensagens vindas do iframe
        window.addEventListener("message", (event) => {
            if (event.data === "atividade") {
                resetarTemporizador();
            }
        });

        window.onload = () => {
            const nome = localStorage.getItem("nome");
            document.getElementById("nomeUsuario").textContent = nome || "Usuário Desconhecido";

            ['mousemove', 'mousedown', 'keydown', 'scroll', 'touchstart'].forEach(evento => {
                document.addEventListener(evento, resetarTemporizador);
            });

            iniciarContagem();
        };
    </script>
</body>
</html>